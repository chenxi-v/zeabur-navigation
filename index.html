<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™¨æ›¦å¯¼èˆª - æç®€çµåŠ¨é£æ ¼</title>
    
    <!-- ç½‘ç«™æ ‡å¿— (Favicon) -->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon-16x16.png">
    <link rel="manifest" href="assets/site.webmanifest">
    
    <style>
        /* style.css - ç‹¬ç«‹æ ·å¼æ–‡ä»¶ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: url('assets/backgrounds/kumtanom.jpg') no-repeat center center fixed;
            background-size: cover;
            font-family: 'Arial', 'Microsoft YaHei', sans-serif;
            padding-top: 50px; /* ä¸ºç§»åŠ¨ç«¯å¤©æ°”æ¡é¢„ç•™ç©ºé—´ */
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
            padding: 20px;
            position: relative;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        /* æ—¶é—´æ—¥æœŸå®¹å™¨æ ·å¼ - ä¿®æ”¹ä¸ºç»¿è‰²+é˜´å½±æ•ˆæœ */
        .datetime-container {
            text-align: center;
            margin: 15px 0;
        }

        .datetime-display {
            display: inline-block;
            background: linear-gradient(135deg, rgba(74, 222, 128, 0.9) 0%, rgba(34, 197, 94, 0.95) 100%);
            padding: 12px 30px;
            border-radius: 25px;
            box-shadow: 
                0 8px 20px rgba(0, 0, 0, 0.25),
                0 4px 10px rgba(0, 0, 0, 0.15),
                inset 0 2px 8px rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.4);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
        }

        .datetime-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
        }

        .datetime-display:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 12px 25px rgba(0, 0, 0, 0.3),
                0 6px 15px rgba(0, 0, 0, 0.2),
                inset 0 2px 10px rgba(255, 255, 255, 0.3);
        }

        #currentDate {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 5px;
            color: #ffffff;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            letter-spacing: 0.5px;
        }

        #currentTime {
            font-size: 1.8rem;
            font-weight: 700;
            color: #ffffff;
            text-shadow: 0 3px 8px rgba(0,0,0,0.4);
            letter-spacing: 1px;
            position: relative;
            display: inline-block;
        }

        #currentTime::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.8), transparent);
        }

        /* æ—¶é—´ç§’æ•°å­—ä½“æ•ˆæœ */
        .seconds {
            color: #fffbeb;
            font-weight: 600;
            text-shadow: 0 1px 3px rgba(0,0,0,0.4);
        }

        .search-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .search-box {
            width: 100%;
            max-width: 600px;
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-input {
            width: 100%;
            padding: 15px 20px 15px 20px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            background-color: white;
        }

        .search-input:focus {
            outline: none;
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            transform: translateY(-2px);
        }

        .search-button {
            position: absolute;
            right: 5px;
            top: 5px;
            bottom: 5px;
            width: 40px;
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
            border: none;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .search-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .search-button svg {
            width: 20px;
            height: 20px;
            fill: white;
        }

        /* åˆ†ç±»ç›´è¾¾æ  */
        .category-nav {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 25px;
            padding: 10px 0;
        }

        .category-nav a {
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 8px 16px;
            border-radius: 20px;
            text-decoration: none;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .category-nav a:hover,
        .category-nav a.active {
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .category {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            scroll-margin-top: 120px; /* è·³è½¬æ—¶ç•™å‡ºé¡¶éƒ¨ç©ºé—´ */
        }

        .category:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }

        .category h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            padding-bottom: 10px;
        }

        .category h2::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, #4ade80, transparent);
            border-radius: 2px;
        }

        .links {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .link-item {
            display: flex;
            align-items: flex-start;
            padding: 12px;
            border-radius: 10px;
            text-decoration: none;
            color: #333;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0,0,0,0.1);
            gap: 12px;
        }

        .link-item:hover {
            background: rgba(74, 222, 128, 0.1);
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .link-icon-container {
            flex-shrink: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .link-icon {
            width: 20px;
            height: 20px;
        }

        .link-content {
            flex: 1;
            min-width: 0;
        }

        .link-text {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .link-desc {
            font-size: 12px;
            color: #666;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .footer {
            text-align: center;
            color: black;
            padding: 20px;
            font-size: 14px;
            opacity: 0.8;
        }

        /* ä¸€é”®å›åˆ°é¡¶éƒ¨æŒ‰é’® */
        #backToTopBtn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.25);
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        #backToTopBtn.visible {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        #backToTopBtn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 6px 16px rgba(0,0,0,0.3);
        }

        #backToTopBtn svg {
            width: 24px;
            height: 24px;
            fill: white;
        }

        /* å¤©æ°”æ’ä»¶æ ·å¼ */
        /* æ¡Œé¢ç«¯åœ†å½¢æ ·å¼ */
        .circular-weather-widget {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 9999;
            width: 120px;
            height: 120px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .weather-circle {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border: 3px solid #fbbf24;
            color: #333;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .weather-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 10px;
        }

        .weather-icon {
            font-size: 42px;
            line-height: 1;
            margin-bottom: 5px;
        }

        .weather-temp {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 2px;
        }

        .weather-location {
            font-size: 12px;
            opacity: 0.8;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 96px;
        }

        /* ç§»åŠ¨ç«¯æ¡å½¢æ ·å¼ - ä¿®å¤é®æŒ¡é—®é¢˜ */
        .weather-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            z-index: 9999;
            padding: 10px 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
            height: 50px; /* è®¾ç½®å›ºå®šé«˜åº¦ */
            box-sizing: border-box;
        }

        .bar-left {
            display: flex;
            align-items: center;
        }

        .bar-icon {
            font-size: 28px;
            margin-right: 10px;
        }

        .bar-info {
            display: flex;
            flex-direction: column;
        }

        .bar-temp {
            font-size: 18px;
            font-weight: bold;
        }

        .bar-location {
            font-size: 12px;
            opacity: 0.8;
        }

        .bar-details {
            font-size: 12px;
            opacity: 0.7;
            text-align: right;
        }

        /* è¯¦æƒ…é¢æ¿ */
        .weather-details {
            position: absolute;
            top: 50%;
            right: calc(100% + 10px);
            transform: translateY(-50%) scale(0.9);
            width: max-content;
            max-width: 200px;
            min-width: 150px;
            padding: 12px 16px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.98);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            text-align: center;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            z-index: 10000;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .weather-details.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(-50%) scale(1);
        }

        .details-arrow {
            position: absolute;
            top: 50%;
            right: -6px;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
            border-left: 6px solid rgba(255, 255, 255, 0.98);
        }

        .details-condition {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 8px;
            white-space: nowrap;
        }

        .details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px 12px;
            width: 100%;
            margin-bottom: 8px;
        }

        .details-item {
            font-size: 12px;
            opacity: 0.8;
            text-align: left;
        }

        .details-item.right {
            text-align: right;
        }

        .details-update {
            font-size: 10px;
            opacity: 0.6;
            margin-top: 4px;
        }

        /* ç§»åŠ¨ç«¯è¯¦æƒ…é¢æ¿ */
        .mobile-details {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .mobile-details.active {
            opacity: 1;
            visibility: visible;
        }

        .mobile-details-content {
            background: white;
            border-radius: 15px;
            padding: 20px;
            width: 80%;
            max-width: 300px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .mobile-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            color: white;
            cursor: pointer;
        }

        .mobile-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .mobile-condition {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .mobile-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .mobile-info-item {
            text-align: center;
            padding: 8px;
            background: #f5f5f5;
            border-radius: 8px;
        }

        .mobile-info-label {
            font-size: 12px;
            opacity: 0.7;
            margin-bottom: 4px;
        }

        .mobile-info-value {
            font-size: 14px;
            font-weight: bold;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .circular-weather-widget {
                display: none;
            }
            
            .weather-bar {
                display: flex;
            }
            
            body {
                padding-top: 50px; /* åœ¨ç§»åŠ¨ç«¯ä¸ºå¤©æ°”æ¡é¢„ç•™ç©ºé—´ */
            }
        }

        @media (min-width: 769px) {
            .weather-bar {
                display: none;
            }
            
            .circular-weather-widget {
                display: block;
            }
            
            body {
                padding-top: 0; /* æ¡Œé¢ç«¯ä¸éœ€è¦é¢å¤–ç©ºé—´ */
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .datetime-display {
                padding: 10px 25px;
                margin: 10px 15px;
            }
            
            #currentDate {
                font-size: 1rem;
            }
            
            #currentTime {
                font-size: 1.5rem;
            }
            
            .search-input {
                padding: 12px 20px 12px 20px;
                font-size: 14px;
            }
            
            .search-button {
                width: 35px;
            }
            
            .search-button svg {
                width: 16px;
                height: 16px;
            }
            
            body {
                padding: 10px;
                padding-top: 60px; /* ç§»åŠ¨ç«¯ä¸ºå¤©æ°”æ¡ä¿ç•™æ›´å¤šç©ºé—´ */
            }
            
            .category-nav {
                gap: 8px;
                padding: 5px 0;
            }
            
            .category-nav a {
                padding: 6px 12px;
                font-size: 13px;
            }
            
            .link-item {
                padding: 10px;
            }
            
            .link-text {
                font-size: 13px;
            }
            
            .link-desc {
                font-size: 11px;
            }
            
            /* ç§»åŠ¨ç«¯å›é¡¶æŒ‰é’®ä½ç½®è°ƒæ•´ */
            #backToTopBtn {
                bottom: 20px;
                right: 20px;
                width: 45px;
                height: 45px;
            }
            
            #backToTopBtn svg {
                width: 20px;
                height: 20px;
            }
        }

        /* æ·»åŠ åŠ è½½åŠ¨ç”» */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>æ™¨æ›¦ğŸŒ¿å¯¼èˆª</h1>
            <p>æ¸…çˆ½è‡ªç„¶ Â· å›å½’æœ¬è´¨</p>
        </div>

        <!-- å¤©æ°”æ’ä»¶ -->
        <!-- æ¡Œé¢ç«¯åœ†å½¢å¤©æ°”æ’ä»¶ -->
        <div class="circular-weather-widget">
            <div class="weather-circle">
                <div class="weather-content">
                    <div class="weather-icon">â›…</div>
                    <div class="weather-temp">24Â°C</div>
                    <div class="weather-location">åŒ—äº¬å¸‚</div>
                </div>
            </div>
            <div class="weather-details">
                <div class="details-arrow"></div>
                <div class="details-condition">å¤šäº‘</div>
                <div class="details-grid">
                    <div class="details-item">æ¹¿åº¦: 65%</div>
                    <div class="details-item right">é£é€Ÿ: 12 km/h</div>
                    <div class="details-item">æ¸©åº¦: 20ï½28Â°C</div>
                    <div class="details-item right">ç©ºæ°”: è‰¯</div>
                </div>
                <div class="details-update">æ›´æ–°: 14:30</div>
            </div>
        </div>

        <!-- ç§»åŠ¨ç«¯æ¡å½¢å¤©æ°”æ’ä»¶ -->
        <div class="weather-bar">
            <div class="bar-left">
                <div class="bar-icon">â›…</div>
                <div class="bar-info">
                    <div class="bar-temp">24Â°C</div>
                    <div class="bar-location">åŒ—äº¬å¸‚</div>
                </div>
            </div>
            <div class="bar-details">å¤šäº‘ | æ¹¿åº¦: 65%</div>
        </div>

        <!-- ç§»åŠ¨ç«¯è¯¦æƒ…é¢æ¿ -->
        <div class="mobile-details">
            <button class="mobile-close">Ã—</button>
            <div class="mobile-details-content">
                <div class="mobile-icon">â›…</div>
                <div class="mobile-condition">å¤šäº‘</div>
                <div class="mobile-info">
                    <div class="mobile-info-item">
                        <div class="mobile-info-label">æ¸©åº¦</div>
                        <div class="mobile-info-value">24Â°C</div>
                    </div>
                    <div class="mobile-info-item">
                        <div class="mobile-info-label">æ¹¿åº¦</div>
                        <div class="mobile-info-value">65%</div>
                    </div>
                    <div class="mobile-info-item">
                        <div class="mobile-info-label">é£é€Ÿ</div>
                        <div class="mobile-info-value">12 km/h</div>
                    </div>
                    <div class="mobile-info-item">
                        <div class="mobile-info-label">ç©ºæ°”è´¨é‡</div>
                        <div class="mobile-info-value">è‰¯</div>
                    </div>
                </div>
                <div style="font-size: 12px; opacity: 0.7;">æ›´æ–°: 14:30</div>
            </div>
        </div>

        <!-- æ—¶é—´æ—¥æœŸæ˜¾ç¤º -->
        <div class="datetime-container">
            <div class="datetime-display">
                <div id="currentDate">æ­£åœ¨åŠ è½½æ—¥æœŸ...</div>
                <div id="currentTime">æ­£åœ¨åŠ è½½æ—¶é—´...</div>
            </div>
        </div>

        <div class="search-container">
            <div class="search-box">
                <input type="text" id="searchInput" class="search-input" placeholder="åœ¨å¿…åº”ä¸­æœç´¢...">
                <button class="search-button" id="searchButton">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- åˆ†ç±»ç›´è¾¾å¯¼èˆªæ  -->
        <div class="category-nav" id="categoryNav"></div>

        <div class="categories" id="categoriesContainer">
            <!-- ç±»åˆ«å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
        </div>

        <div class="footer">
            <p>ğŸŒ± éƒ¨ç½²åœ¨ Zeabur Platform | ğŸ“¦ ä»£ç æ‰˜ç®¡åœ¨ GitHub</p>
        </div>
    </div>

    <!-- ä¸€é”®å›åˆ°é¡¶éƒ¨æŒ‰é’® -->
    <button id="backToTopBtn" title="å›åˆ°é¡¶éƒ¨">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 19V7.83l4.88 4.88c.39.39 1.03.39 1.42 0 .39-.39.39-1.02 0-1.41L12.71 4.71a.996.996 0 0 0-1.41 0L4.71 11.3c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0L11 7.83V19c0 .55.45 1 1 1s1-.45 1-1z"/>
        </svg>
    </button>

    <script>
        // å¤©æ°”å›¾æ ‡æ˜ å°„
        const weatherIcons = {
          'æ™´': 'â˜€ï¸',
          'å¤šäº‘': 'â›…',
          'é˜´': 'â˜ï¸',
          'å°é›¨': 'ğŸŒ¦ï¸',
          'ä¸­é›¨': 'ğŸŒ§ï¸',
          'å¤§é›¨': 'ğŸŒ§ï¸',
          'æš´é›¨': 'â›ˆï¸',
          'é›·': 'âš¡',
          'é›ª': 'â„ï¸',
          'é›¾': 'ğŸŒ«ï¸',
          'éœ¾': 'ğŸŒ«ï¸',
          'æœªçŸ¥': 'ğŸŒ¤ï¸'
        };

        // å¤„ç† Open Meteo API è¿”å›çš„å¤©æ°”æ•°æ®
        function processWeatherData(data, timestamp, userLocation = '', coordinates = null) {
          if (!data || data.error) {
            const errorMessage = data && data.reason ? data.reason : 'è¯¥ä½ç½®æš‚ä¸æ”¯æŒ';
            return {
              location: userLocation || 'æœªçŸ¥ä½ç½®',
              condition: errorMessage,
              temperature: 'N/A',
              tempRange: 'N/A',
              airQuality: 'N/A',
              humidity: 'N/A',
              windSpeed: 'N/A',
              icon: weatherIcons['æœªçŸ¥']
            };
          }
          
          const current = data.current || {};
          const weatherCode = current.weather_code || 0;
          const temperature = current.temperature_2m !== undefined ? `${Math.round(current.temperature_2m)}Â°C` : 'N/A';
          let tempRange = 'N/A';
          if (data.daily) {
            const minTemp = data.daily.temperature_2m_min?.[0];
            const maxTemp = data.daily.temperature_2m_max?.[0];
            if (minTemp !== undefined && maxTemp !== undefined) {
              tempRange = `${Math.round(minTemp)}ï½${Math.round(maxTemp)}Â°C`;
            }
          }
          
          let humidity = 'N/A';
          if (data.current && data.current.relative_humidity_2m !== undefined) {
            humidity = `${data.current.relative_humidity_2m}%`;
          }
          
          let airQuality = 'N/A';
          if (data.current && data.current.european_aqi !== undefined) {
            const aqi = data.current.european_aqi;
            let aqiLevel = '';
            if (aqi <= 20) aqiLevel = 'ä¼˜';
            else if (aqi <= 40) aqiLevel = 'è‰¯';
            else if (aqi <= 60) aqiLevel = 'ä¸­ç­‰';
            else if (aqi <= 80) aqiLevel = 'ä¸€èˆ¬';
            else if (aqi <= 100) aqiLevel = 'å·®';
            else aqiLevel = 'ä¸¥é‡';
            airQuality = `${aqiLevel} (${aqi})`;
          }
          
          let windSpeed = 'N/A';
          if (data.current && data.current.wind_speed_10m !== undefined) {
            windSpeed = `${Math.round(data.current.wind_speed_10m)} km/h`;
          }
          
          let weatherCondition = 'æœªçŸ¥';
          let weatherIcon = weatherIcons['æœªçŸ¥'];
          if (weatherCode !== undefined) {
            if (weatherCode === 0) {
              weatherCondition = 'æ™´';
              weatherIcon = weatherIcons['æ™´'];
            } else if (weatherCode === 1) {
              weatherCondition = 'å¤§éƒ¨æ™´æœ—';
              weatherIcon = weatherIcons['æ™´'];
            } else if (weatherCode === 2) {
              weatherCondition = 'å±€éƒ¨å¤šäº‘';
              weatherIcon = weatherIcons['å¤šäº‘'];
            } else if (weatherCode === 3) {
              weatherCondition = 'å¤šäº‘';
              weatherIcon = weatherIcons['å¤šäº‘'];
            } else if ([45, 48].includes(weatherCode)) {
              weatherCondition = 'é›¾';
              weatherIcon = weatherIcons['é›¾'];
            } else if ([51, 53, 55, 56, 57].includes(weatherCode)) {
              weatherCondition = 'å°é›¨';
              weatherIcon = weatherIcons['å°é›¨'];
            } else if ([61, 63, 66, 80, 81].includes(weatherCode)) {
              weatherCondition = 'ä¸­é›¨';
              weatherIcon = weatherIcons['ä¸­é›¨'];
            } else if ([65, 67, 82].includes(weatherCode)) {
              weatherCondition = 'å¤§é›¨';
              weatherIcon = weatherIcons['å¤§é›¨'];
            } else if ([95, 96, 99].includes(weatherCode)) {
              weatherCondition = 'é›·é›¨';
              weatherIcon = weatherIcons['é›·'];
            } else if ([71, 73, 75, 77, 85, 86].includes(weatherCode)) {
              weatherCondition = 'é›ª';
              weatherIcon = weatherIcons['é›ª'];
            } else {
              weatherCondition = 'é˜´';
              weatherIcon = weatherIcons['é˜´'];
            }
          }
          
          return {
            location: userLocation || 'æœªçŸ¥ä½ç½®',
            condition: weatherCondition,
            temperature: temperature,
            tempRange: tempRange,
            airQuality: airQuality,
            humidity: humidity,
            windSpeed: windSpeed,
            icon: weatherIcon,
            color: '#94a3b8',
            timestamp: timestamp
          };
        }

        // è·å–ç”¨æˆ·ä½ç½®ä¿¡æ¯å’Œç»çº¬åº¦åæ ‡
        async function fetchUserLocation() {
          try {
            console.log('æ­£åœ¨ä½¿ç”¨ api.myip.la è·å–åœ°åŒºä¿¡æ¯å’Œåæ ‡...');
            let location = '';
            let coordinates = null;
            
            try {
              const controller = new AbortController();
              const timeoutId = setTimeout(() => controller.abort(), 4000);
              const myipLaResponse = await fetch('https://api.myip.la/cn?json', {
                signal: controller.signal,
                headers: {
                  'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36',
                  'Accept-Language': 'zh-CN,zh;q=0.9'
                }
              });
              clearTimeout(timeoutId);
              
              if (myipLaResponse.ok) {
                const data = await myipLaResponse.json();
                console.log('api.myip.la è¿”å›æ•°æ®:', data);
                if (data && data.location) {
                  if (data.location.latitude && data.location.longitude) {
                    coordinates = {
                      latitude: parseFloat(data.location.latitude),
                      longitude: parseFloat(data.location.longitude)
                    };
                    console.log(`ä» api.myip.la è·å–åˆ°åæ ‡: ${coordinates.latitude}, ${coordinates.longitude}`);
                  }
                  
                  const province = data.location.province || '';
                  const city = data.location.city || '';
                  if (province && city) {
                    if (city.includes(province.replace('çœ', '').replace('å¸‚', '').replace('éƒ½', ''))) {
                      location = city;
                    } else {
                      location = province + city;
                    }
                    console.log(`ä» api.myip.la è·å–åˆ°ä½ç½®: ${location}`);
                  } else if (province) {
                    location = province;
                  } else if (city) {
                    location = city;
                  } else if (data.location.country_name) {
                    location = data.location.country_name;
                  }
                }
              }
            } catch (error) {
              console.warn('api.myip.la è·å–å¤±è´¥ï¼Œå°†å›é€€åˆ°å¤‡ç”¨æ–¹æ¡ˆ:', error.message);
            }
            
            if (!location) {
              console.log('æ­£åœ¨ä½¿ç”¨å¤‡ç”¨ API myip.ipip.net è·å–åœ°åŒºä¿¡æ¯...');
              try {
                const ipipResponse = await fetch('https://myip.ipip.net', {
                  headers: {
                    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36',
                    'Referer': 'https://www.baidu.com/',
                    'Accept-Language': 'zh-CN,zh;q=0.9',
                    'Keep-Alive': 'yes',
                    'Cache-Control': 'no-cache'
                  }
                });
                
                if (ipipResponse.ok) {
                  const text = await ipipResponse.text();
                  console.log('myip.ipip.net è¿”å›æ•°æ®:', text);
                  if (text && text.includes('æ¥è‡ªäºï¼š')) {
                    const locationPart = text.split('æ¥è‡ªäºï¼š')[1];
                    if (locationPart) {
                      const locationInfo = locationPart.split(' ')[0];
                      if (locationInfo) {
                        const parts = locationInfo.trim().split(' ');
                        if (parts.length >= 3) {
                          location = parts[1] + parts[2];
                        } else if (parts.length === 2) {
                          location = parts[1];
                        } else {
                          location = parts[0];
                        }
                        console.log(`ä» myip.ipip.net è·å–åˆ°ä½ç½®: ${location}`);
                        
                        try {
                          console.log(`æ­£åœ¨ä½¿ç”¨ OpenStreetMap è·å– ${location} çš„åæ ‡...`);
                          coordinates = await getCoordinates(location);
                          if (coordinates) {
                            console.log(`æˆåŠŸè·å– ${location} çš„åæ ‡: ${coordinates.latitude}, ${coordinates.longitude}`);
                          }
                        } catch (geoError) {
                          console.error(`è·å– ${location} åæ ‡å¤±è´¥:`, geoError);
                        }
                      }
                    }
                  }
                }
              } catch (fallbackError) {
                console.error('å¤‡ç”¨ API ä¹Ÿå¤±è´¥äº†:', fallbackError.message);
              }
            }
            
            if (!location) {
              console.warn('æ— æ³•è·å–ä½ç½®ä¿¡æ¯');
              return { location: '', coordinates: null };
            }
            
            console.log(`æœ€ç»ˆä½¿ç”¨çš„ä½ç½®: ${location}`);
            return { location, coordinates };
          } catch (error) {
            console.error('è·å–ä½ç½®ä¿¡æ¯è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:', error);
            return { location: '', coordinates: null };
          }
        }

        // å°†åŸå¸‚åç§°è½¬æ¢ä¸ºç»çº¬åº¦åæ ‡
        async function getCoordinates(cityName) {
          if (!cityName) return null;
          
          try {
            const geocodeUrl = `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(cityName)}&format=json&limit=1&accept-language=zh-Hans&countrycodes=CN`;
            console.log(`æ­£åœ¨è·å– ${cityName} çš„åæ ‡...`);
            
            const response = await fetch(geocodeUrl, {
              headers: {
                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36',
                'Accept-Language': 'zh-CN,zh;q=0.9'
              }
            });
            
            if (!response.ok) {
              throw new Error('åœ°ç†ç¼–ç è¯·æ±‚å¤±è´¥');
            }
            
            const data = await response.json();
            if (data && data.length > 0) {
              const { lat, lon } = data[0];
              console.log(`è·å–åˆ° ${cityName} çš„åæ ‡: ${lat}, ${lon}`);
              return { latitude: parseFloat(lat), longitude: parseFloat(lon) };
            }
            
            if (cityName.length > 2) {
              const province = cityName.substring(0, 2);
              console.log(`å°è¯•ä½¿ç”¨çœä»½åç§°è·å–åæ ‡: ${province}`);
              const provinceUrl = `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(province)}&format=json&limit=1&accept-language=zh-Hans&countrycodes=CN`;
              const provinceResponse = await fetch(provinceUrl, {
                headers: {
                  'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36',
                  'Accept-Language': 'zh-CN,zh;q=0.9'
                }
              });
              
              if (provinceResponse.ok) {
                const provinceData = await provinceResponse.json();
                if (provinceData && provinceData.length > 0) {
                  const { lat, lon } = provinceData[0];
                  console.log(`ä½¿ç”¨çœä»½ ${province} çš„åæ ‡: ${lat}, ${lon}`);
                  return { latitude: parseFloat(lat), longitude: parseFloat(lon) };
                }
              }
            }
            
            console.warn(`æ— æ³•è·å– ${cityName} çš„åæ ‡ï¼Œå¤©æ°”æœåŠ¡æš‚ä¸æ”¯æŒè¯¥åœ°åŒº`);
            return null;
          } catch (error) {
            console.error('è·å–åæ ‡å¤±è´¥:', error);
            return null;
          }
        }

        // è·å–å½“åœ°å¤©æ°”ä¿¡æ¯
        async function fetchWeather() {
          const now = Date.now();
          const CACHE_DURATION = 3600000;
          
          // æ£€æŸ¥ç¼“å­˜
          const cacheKey = 'weatherCache';
          const cachedData = localStorage.getItem(cacheKey);
          if (cachedData) {
            const cacheData = JSON.parse(cachedData);
            if (now - cacheData.lastUpdated < CACHE_DURATION) {
              console.log('ä½¿ç”¨ç¼“å­˜çš„å¤©æ°”ä¿¡æ¯');
              return cacheData.data;
            }
          }
          
          try {
            const { location, coordinates } = await fetchUserLocation();
            console.log(`è·å–åˆ°ä½ç½®: ${location}`);
            
            if (!location) {
              const errorData = processWeatherData({ error: true, reason: 'è¯¥ä½ç½®æš‚ä¸æ”¯æŒ' }, now, 'æœªçŸ¥ä½ç½®');
              return errorData;
            }
            
            if (!coordinates) {
              const errorData = processWeatherData({ error: true, reason: 'æ— æ³•è·å–è¯¥ä½ç½®çš„åæ ‡' }, now, location);
              return errorData;
            }
            
            const weatherApiUrl = `https://api.open-meteo.com/v1/forecast?latitude=${coordinates.latitude}&longitude=${coordinates.longitude}&current=temperature_2m,weather_code,relative_humidity_2m,wind_speed_10m&daily=temperature_2m_max,temperature_2m_min&timezone=auto&forecast_days=1`;
            const airQualityApiUrl = `https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${coordinates.latitude}&longitude=${coordinates.longitude}&current=european_aqi&timezone=auto`;
            
            console.log('æ­£åœ¨è·å–å¤©æ°”ä¿¡æ¯...');
            console.log('å¤©æ°” API URL:', weatherApiUrl);
            console.log('ç©ºæ°”è´¨é‡ API URL:', airQualityApiUrl);
            
            const weatherController = new AbortController();
            const weatherTimeoutId = setTimeout(() => weatherController.abort(), 4000);
            const weatherResponse = await fetch(weatherApiUrl, {
              signal: weatherController.signal,
              headers: {
                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36',
                'Accept-Language': 'zh-CN,zh;q=0.9'
              }
            });
            clearTimeout(weatherTimeoutId);
            
            if (!weatherResponse.ok) {
              throw new Error(`è·å–å¤©æ°”ä¿¡æ¯å¤±è´¥: ${weatherResponse.status} ${weatherResponse.statusText}`);
            }
            
            const weatherData = await weatherResponse.json();
            
            let airQualityData = { current: { european_aqi: null } };
            try {
              const airQualityController = new AbortController();
              const airQualityTimeoutId = setTimeout(() => airQualityController.abort(), 5000);
              const airQualityResponse = await fetch(airQualityApiUrl, {
                signal: airQualityController.signal,
                headers: {
                  'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36',
                  'Accept-Language': 'zh-CN,zh;q=0.9'
                }
              });
              clearTimeout(airQualityTimeoutId);
              
              if (airQualityResponse.ok) {
                airQualityData = await airQualityResponse.json();
                console.log('ç©ºæ°”è´¨é‡æ•°æ®è·å–æˆåŠŸ:', airQualityData);
              } else {
                console.warn(`è·å–ç©ºæ°”è´¨é‡ä¿¡æ¯å¤±è´¥: ${airQualityResponse.status} ${airQualityResponse.statusText}`);
              }
            } catch (airQualityError) {
              console.warn('è·å–ç©ºæ°”è´¨é‡æ•°æ®æ—¶å‡ºé”™:', airQualityError);
            }
            
            const combinedData = {
              ...weatherData,
              current: {
                ...weatherData.current,
                european_aqi: airQualityData.current?.european_aqi
              }
            };
            
            const parsedWeatherData = processWeatherData(combinedData, now, location, coordinates);
            
            // ä¿å­˜åˆ°ç¼“å­˜
            localStorage.setItem(cacheKey, JSON.stringify({
              data: parsedWeatherData,
              lastUpdated: now
            }));
            
            return parsedWeatherData;
          } catch (error) {
            console.error('è·å–å¤©æ°”ä¿¡æ¯å¤±è´¥:', error);
            const errorData = processWeatherData({ error: true, reason: error.message }, Date.now(), 'æœªçŸ¥ä½ç½®');
            return errorData;
          }
        }

        // æ£€æµ‹æ˜¯å¦ä¸ºç§»åŠ¨è®¾å¤‡
        function isMobileDevice() {
          return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
            (window.innerWidth <= 768);
        }

        // æ›´æ–°æ¡Œé¢ç«¯åœ†å½¢æ’ä»¶
        function updateCircularWidget(weatherData) {
          const circularWidget = document.querySelector('.circular-weather-widget');
          const circle = circularWidget.querySelector('.weather-circle');
          const icon = circularWidget.querySelector('.weather-icon');
          const temp = circularWidget.querySelector('.weather-temp');
          const location = circularWidget.querySelector('.weather-location');
          const details = circularWidget.querySelector('.weather-details');
          const condition = details.querySelector('.details-condition');
          const humidity = details.querySelector('.details-item:nth-child(1)');
          const wind = details.querySelector('.details-item:nth-child(2)');
          const tempRange = details.querySelector('.details-item:nth-child(3)');
          const airQuality = details.querySelector('.details-item:nth-child(4)');
          const updateTime = details.querySelector('.details-update');
          
          // æ›´æ–°å†…å®¹
          circle.style.borderColor = weatherData.color;
          icon.textContent = weatherData.icon;
          temp.textContent = weatherData.temperature;
          location.textContent = weatherData.location;
          
          // æ›´æ–°è¯¦æƒ…
          condition.textContent = weatherData.condition;
          humidity.textContent = `æ¹¿åº¦: ${weatherData.humidity}`;
          wind.textContent = `é£é€Ÿ: ${weatherData.windSpeed}`;
          tempRange.textContent = `æ¸©åº¦: ${weatherData.tempRange}`;
          airQuality.textContent = `ç©ºæ°”: ${weatherData.airQuality.split(' ')[0]}`;
          
          const updateDate = new Date(weatherData.timestamp);
          updateTime.textContent = `æ›´æ–°: ${updateDate.getHours().toString().padStart(2, '0')}:${updateDate.getMinutes().toString().padStart(2, '0')}`;
        }

        // æ›´æ–°ç§»åŠ¨ç«¯æ¡å½¢æ’ä»¶
        function updateBarWidget(weatherData) {
          const barWidget = document.querySelector('.weather-bar');
          const icon = barWidget.querySelector('.bar-icon');
          const temp = barWidget.querySelector('.bar-temp');
          const location = barWidget.querySelector('.bar-location');
          const details = barWidget.querySelector('.bar-details');
          
          // æ›´æ–°å†…å®¹
          icon.textContent = weatherData.icon;
          temp.textContent = weatherData.temperature;
          location.textContent = weatherData.location;
          details.textContent = `${weatherData.condition} | æ¹¿åº¦: ${weatherData.humidity}`;
        }

        // æ›´æ–°ç§»åŠ¨ç«¯è¯¦æƒ…é¢æ¿
        function updateMobileDetails(weatherData) {
          const mobileDetails = document.querySelector('.mobile-details');
          const mobileIcon = mobileDetails.querySelector('.mobile-icon');
          const mobileCondition = mobileDetails.querySelector('.mobile-condition');
          const tempValue = mobileDetails.querySelector('.mobile-info-item:nth-child(1) .mobile-info-value');
          const humidityValue = mobileDetails.querySelector('.mobile-info-item:nth-child(2) .mobile-info-value');
          const windValue = mobileDetails.querySelector('.mobile-info-item:nth-child(3) .mobile-info-value');
          const airQualityValue = mobileDetails.querySelector('.mobile-info-item:nth-child(4) .mobile-info-value');
          
          // æ›´æ–°å†…å®¹
          mobileIcon.textContent = weatherData.icon;
          mobileCondition.textContent = weatherData.condition;
          tempValue.textContent = weatherData.temperature;
          humidityValue.textContent = weatherData.humidity;
          windValue.textContent = weatherData.windSpeed;
          airQualityValue.textContent = weatherData.airQuality.split(' ')[0];
        }

        // æ·»åŠ äº¤äº’äº‹ä»¶
        function addInteractions(weatherData) {
          const circularWidget = document.querySelector('.circular-weather-widget');
          const circle = circularWidget.querySelector('.weather-circle');
          const details = circularWidget.querySelector('.weather-details');
          
          const barWidget = document.querySelector('.weather-bar');
          const mobileDetails = document.querySelector('.mobile-details');
          const closeButton = mobileDetails.querySelector('.mobile-close');
          
          // æ¡Œé¢ç«¯æ‚¬åœæ•ˆæœ
          circle.addEventListener('mouseenter', () => {
            details.classList.add('active');
            circle.style.transform = 'scale(1.05)';
            circle.style.boxShadow = '0 8px 30px rgba(0, 0, 0, 0.25)';
          });
          
          circle.addEventListener('mouseleave', () => {
            details.classList.remove('active');
            circle.style.transform = 'scale(1)';
            circle.style.boxShadow = '0 4px 20px rgba(0, 0, 0, 0.15)';
          });
          
          // ç§»åŠ¨ç«¯ç‚¹å‡»æ•ˆæœ
          barWidget.addEventListener('click', () => {
            mobileDetails.classList.add('active');
          });
          
          closeButton.addEventListener('click', () => {
            mobileDetails.classList.remove('active');
          });
          
          // ç‚¹å‡»åœ†å½¢åˆ·æ–°
          circle.addEventListener('click', async () => {
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            circle.classList.add('loading');
            try {
              const weatherData = await fetchWeather();
              updateCircularWidget(weatherData);
              updateBarWidget(weatherData);
              updateMobileDetails(weatherData);
              console.log('å¤©æ°”æ•°æ®å·²åˆ·æ–°ï¼');
            } catch (error) {
              console.error('åˆ·æ–°å¤©æ°”æ•°æ®å¤±è´¥:', error);
            } finally {
              // ç§»é™¤åŠ è½½çŠ¶æ€
              circle.classList.remove('loading');
            }
          });
        }

        // åˆå§‹åŒ–å¤©æ°”æ’ä»¶
        async function initWeatherPlugin() {
          try {
            const weatherData = await fetchWeather();
            updateCircularWidget(weatherData);
            updateBarWidget(weatherData);
            updateMobileDetails(weatherData);
            addInteractions(weatherData);
          } catch (error) {
            console.error('åˆå§‹åŒ–å¤©æ°”æ’ä»¶å¤±è´¥:', error);
          }
        }

        // æ—¶é—´æ—¥æœŸæ›´æ–°å‡½æ•° - ä¼˜åŒ–äº†ç§’æ•°æ˜¾ç¤ºæ•ˆæœ
        function updateDateTime() {
          const now = new Date();
          
          // æ ¼å¼åŒ–æ—¥æœŸ
          const year = now.getFullYear();
          const month = String(now.getMonth() + 1).padStart(2, '0');
          const day = String(now.getDate()).padStart(2, '0');
          const weekdays = ['æ˜ŸæœŸæ—¥', 'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­'];
          const weekday = weekdays[now.getDay()];
          
          // æ ¼å¼åŒ–æ—¶é—´
          const hours = String(now.getHours()).padStart(2, '0');
          const minutes = String(now.getMinutes()).padStart(2, '0');
          const seconds = String(now.getSeconds()).padStart(2, '0');
          
          // æ›´æ–°æ˜¾ç¤º - ç§’æ•°æ·»åŠ ç‰¹æ®Šæ ·å¼
          document.getElementById('currentDate').textContent = `${year}å¹´${month}æœˆ${day}æ—¥ ${weekday}`;
          document.getElementById('currentTime').innerHTML = `${hours}:${minutes}:<span class="seconds">${seconds}</span>`;
          
          // æ¯ç§’é—ªçƒæ•ˆæœ
          const secondsSpan = document.querySelector('#currentTime .seconds');
          if (secondsSpan) {
            secondsSpan.style.opacity = (now.getSeconds() % 2 === 0) ? '1' : '0.9';
          }
        }

        // æ‰§è¡Œæœç´¢åŠŸèƒ½
        function performSearch() {
          const searchInput = document.getElementById('searchInput');
          const searchTerm = searchInput.value.trim();
          if (searchTerm) {
            window.open(`https://www.bing.com/search?q=${encodeURIComponent(searchTerm)}`, '_blank');
            searchInput.value = '';
          }
        }

        // æ¸²æŸ“å•ä¸ªé“¾æ¥é¡¹ï¼ˆåŒ…å«ä»‹ç»å’Œæœ¬åœ°å›¾æ ‡ï¼‰
        function renderLinkItem(link) {
          return `
              <a href="${link.url}" class="link-item" target="_blank" title="${link.name}: ${link.desc}">
                  <div class="link-icon-container">
                      <img src="${link.icon}" alt="${link.name}" class="link-icon" onerror="this.style.display='none'">
                  </div>
                  <div class="link-content">
                      <div class="link-text">${link.name}</div>
                      <div class="link-desc">${link.desc}</div>
                  </div>
              </a>
          `;
        }

        // æ¸²æŸ“å¯¼èˆªç±»åˆ«
        function renderCategories(navData) {
          const container = document.getElementById('categoriesContainer');
          container.innerHTML = '';

          navData.categories.forEach(category => {
            const categoryDiv = document.createElement('div');
            categoryDiv.className = 'category';
            categoryDiv.id = `category-${category.id}`; // æ·»åŠ IDç”¨äºé”šç‚¹è·³è½¬
            
            let linksHtml = '';
            category.links.forEach(link => {
              linksHtml += renderLinkItem(link);
            });

            categoryDiv.innerHTML = `
                <h2>${category.icon} ${category.name}</h2>
                <div class="links">${linksHtml}</div>
            `;
            
            container.appendChild(categoryDiv);
          });
        }

        // æ¸²æŸ“åˆ†ç±»ç›´è¾¾å¯¼èˆªæ 
        function renderCategoryNav(navData) {
          const navContainer = document.getElementById('categoryNav');
          let navHtml = '';
          
          navData.categories.forEach(category => {
            navHtml += `
                <a href="#category-${category.id}" data-category="${category.id}">
                    ${category.icon} ${category.name}
                </a>
            `;
          });
          
          navContainer.innerHTML = navHtml;
          
          // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
          navContainer.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', function(e) {
              e.preventDefault();
              
              // ç§»é™¤æ‰€æœ‰ active ç±»
              navContainer.querySelectorAll('a').forEach(a => {
                a.classList.remove('active');
              });
              
              // ä¸ºå½“å‰ç‚¹å‡»çš„æ·»åŠ  active ç±»
              this.classList.add('active');
              
              // è·å–ç›®æ ‡å…ƒç´ å¹¶æ»šåŠ¨åˆ°è¯¥ä½ç½®
              const targetId = this.getAttribute('href');
              const targetElement = document.querySelector(targetId);
              
              if (targetElement) {
                // è®¡ç®—æ»šåŠ¨ä½ç½®ï¼ˆè€ƒè™‘å›ºå®šå¤´éƒ¨é«˜åº¦ï¼‰
                const offsetTop = targetElement.offsetTop - 100;
                window.scrollTo({
                  top: offsetTop,
                  behavior: 'smooth'
                });
              }
            });
          });
        }

        // æœç´¢åŠŸèƒ½ - é›†æˆå¿…åº”æœç´¢
        function setupSearch() {
          const searchInput = document.getElementById('searchInput');
          const searchButton = document.getElementById('searchButton');
          
          searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
              performSearch();
            }
          });
          
          searchButton.addEventListener('click', performSearch);
        }

        // ä¸€é”®å›åˆ°é¡¶éƒ¨åŠŸèƒ½
        function setupBackToTop() {
          const button = document.getElementById('backToTopBtn');
          
          // æ»šåŠ¨äº‹ä»¶ç›‘å¬
          window.addEventListener('scroll', () => {
            if (window.scrollY > 300) {
              button.classList.add('visible');
            } else {
              button.classList.remove('visible');
            }
          });
          
          // ç‚¹å‡»äº‹ä»¶
          button.addEventListener('click', () => {
            window.scrollTo({
              top: 0,
              behavior: 'smooth'
            });
          });
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
          // åˆå§‹åŒ–æ—¶é—´æ—¥æœŸæ˜¾ç¤º
          updateDateTime();
          setInterval(updateDateTime, 1000); // æ¯ç§’æ›´æ–°ä¸€æ¬¡
          
          // åˆå§‹åŒ–å¤©æ°”æ’ä»¶
          initWeatherPlugin();
          
          // åŠ è½½å¯¼èˆªæ•°æ®å¹¶æ¸²æŸ“é¡µé¢
          fetch('nav-data.json')
              .then(response => response.json())
              .then(navData => {
                  renderCategories(navData);
                  renderCategoryNav(navData);
              })
              .catch(error => {
                  console.error('åŠ è½½å¯¼èˆªæ•°æ®å¤±è´¥:', error);
                  document.getElementById('categoriesContainer').innerHTML = '<p style="text-align:center;color:white;">å¯¼èˆªæ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥</p>';
              });
          
          setupSearch();
          setupBackToTop(); // åˆå§‹åŒ–å›é¡¶åŠŸèƒ½
          
          // æ·»åŠ æ‚¬åœæ•ˆæœ
          document.querySelectorAll('.category').forEach(cat => {
            cat.addEventListener('mouseenter', function() {
              this.style.transform = 'translateY(-5px)';
            });
            
            cat.addEventListener('mouseleave', function() {
              this.style.transform = 'translateY(0)';
            });
          });
        });
    </script>
</body>
</html>
